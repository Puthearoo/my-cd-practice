name: CI/CD Frontend Only

on:
  push:
    branches: [test-workflow]
  pull_request:
    branches: [test-workflow]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Debug - Show project structure
        run: |
          echo "Project structure:"
          ls -la
          echo "Frontend contents:"
          ls -la my-cicd-frontend/

      # SSH Deployment to your server
      - name: Deploy Frontend via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ vars.SERVER_IP }}
          username: ${{ vars.USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ vars.SSH_PORT }} # default 22 if not set
          script: |
            echo "ðŸš€ Starting frontend deployment..."

            # Create project directory
            sudo mkdir -p /var/www/my-app/frontend

            # Copy frontend files
            echo "ðŸ“¦ Deploying frontend..."
            sudo cp -r $GITHUB_WORKSPACE/my-cicd-frontend/* /var/www/my-app/frontend/

            # Configure Nginx to serve frontend only
            echo "ðŸŒ Setting up Nginx..."
            sudo bash -c 'cat > /etc/nginx/sites-available/my-app << EOF
            server {
                listen 80;
                server_name _;

                root /var/www/my-app/frontend;
                index index.html;

                location / {
                    try_files \$uri /index.html;
                }
            }
            EOF'

            # Enable site and restart Nginx
            sudo ln -sf /etc/nginx/sites-available/my-app /etc/nginx/sites-enabled/
            sudo nginx -t && sudo systemctl restart nginx

            echo "âœ… Frontend deployment completed! Visit: http://${{ vars.SERVER_IP }}"
